# 💬 دليل نظام الشات - مركز التمريض

## **نظرة عامة**

نظام شات دعم فني متكامل يربط المستخدمين بالأدمن بشكل سلس وفعال.

---

## **🎯 للمستخدمين**

### **كيفية الاستخدام:**

1. **سجل دخول** إلى الموقع
2. **افتح أي صفحة** (dashboard.html, pdf-viewer.html, etc.)
3. **شاهد الأيقونة العائمة** 💬 في الزاوية اليمنى السفلى
4. **اضغط على الأيقونة** لفتح نافذة الشات
5. **اكتب رسالتك** في الحقل السفلي
6. **اضغط Enter** أو **زر الإرسال** ✈️

### **استقبال الرد:**
- الردود تظهر تلقائياً في الشات
- Badge يظهر عدد الردود الجديدة
- التحديث يحدث كل 10 ثواني

---

## **👑 للأدمن**

### **الوصول لصفحة الرسائل:**

1. **افتح** `admin-backend.html`
2. **شاهد زر "الرسائل"** في الأعلى
3. **Badge** يظهر عدد الرسائل غير المقروءة
4. **اضغط "الرسائل"** للانتقال لـ `messages.html`

### **إدارة الرسائل:**

#### **الإحصائيات:**
- 📊 إجمالي الرسائل
- ✅ تم الرد عليها
- 🔔 لم تُقرأ بعد

#### **الفلترة:**
```
🔘 الكل          → كل الرسائل
🔘 غير مقروءة    → الرسائل الجديدة
🔘 مقروءة        → تم فتحها
🔘 تم الرد       → تم الرد عليها
```

#### **الإجراءات:**
1. **رد** → فتح modal للرد على الرسالة
2. **تعليم كمقروءة** → تغيير الحالة
3. **حذف** → حذف الرسالة نهائياً

### **الرد على رسالة:**

1. **اضغط زر "رد"** على الرسالة
2. **اكتب ردك** في الـ textarea
3. **اضغط "إرسال الرد"**
4. ✅ الرد يُرسل للمستخدم فوراً!

---

## **🔧 تفاصيل تقنية**

### **الملفات:**
```
📄 chat-widget.js       → Widget المستخدمين
📄 messages.html        → صفحة إدارة الأدمن
📄 data/messages.json   → تخزين الرسائل
```

### **API Endpoints:**
```javascript
POST   /api/messages                 // إرسال رسالة جديدة
GET    /api/messages                 // جلب كل الرسائل
POST   /api/messages/:id/reply       // الرد على رسالة
PUT    /api/messages/:id/read        // تعليم كمقروءة
DELETE /api/messages/:id             // حذف رسالة
GET    /api/messages/unread/count    // عدد غير المقروءة
```

### **بنية بيانات الرسالة:**
```json
{
  "id": 1759468123456,
  "userId": "user123",
  "userName": "أحمد محمد",
  "userEmail": "ahmed@example.com",
  "message": "كيف يمكنني تحميل الملفات؟",
  "timestamp": "2025-10-03T10:30:00.000Z",
  "status": "unread",           // unread, read, replied
  "adminReply": null,
  "adminReplyTime": null
}
```

### **الحالات (Status):**
- `unread` → رسالة جديدة لم تُفتح
- `read` → تم فتحها ولم يُرد عليها
- `replied` → تم الرد عليها

---

## **⚡ التحديث التلقائي**

### **للمستخدمين:**
```javascript
// تحميل الردود كل 10 ثواني
setInterval(loadMessages, 10000);
```

### **للأدمن:**
```javascript
// تحديث الرسائل كل 10 ثواني
setInterval(loadMessages, 10000);

// تحديث badge كل 5 ثواني
setInterval(updateMessagesCount, 5000);
```

---

## **🎨 التصميم**

### **Widget المستخدمين:**
- ✅ أيقونة عائمة بـ gradient جميل
- ✅ Animation عند الفتح (slideUp)
- ✅ Badge notification (pulse animation)
- ✅ Modal responsive
- ✅ Scrollbar مخصص

### **صفحة الأدمن:**
- ✅ Cards للإحصائيات
- ✅ فلاتر تفاعلية
- ✅ Message cards ملونة حسب الحالة
- ✅ Modal للرد
- ✅ Responsive design

---

## **🚀 كيفية التفعيل**

### **1. التأكد من الملفات:**
```bash
✅ data/messages.json موجود
✅ chat-widget.js موجود
✅ messages.html موجود
✅ server.js يحتوي على endpoints
```

### **2. إضافة Widget لصفحات جديدة:**
```html
<!-- قبل إغلاق </body> -->
<script src="chat-widget.js"></script>
```

### **3. تشغيل السيرفر:**
```bash
npm start
```

---

## **📊 الإحصائيات**

### **الميزات:**
- ✅ 6 API endpoints
- ✅ تحديث تلقائي
- ✅ Badge notification
- ✅ 3 حالات للرسائل
- ✅ فلترة متقدمة
- ✅ Modal للرد
- ✅ تخزين دائم

### **حد الأداء:**
- ⚡ استعلام كل 10 ثواني (users)
- ⚡ استعلام كل 10 ثواني (admin)
- ⚡ Badge كل 5 ثواني (admin)
- 💾 JSON file storage

---

## **🔐 الأمان**

### **ما تم تطبيقه:**
- ✅ التحقق من تسجيل الدخول
- ✅ تخزين userId مع الرسالة
- ✅ Validation للحقول
- ✅ Error handling

### **للإنتاج:**
- ⚠️ إضافة rate limiting
- ⚠️ تشفير الرسائل
- ⚠️ Sanitize input
- ⚠️ استخدام WebSocket

---

## **🎯 أمثلة الاستخدام**

### **مثال 1: سؤال من مستخدم**
```
👤 User: "كيف أقوم بتحميل ملف PDF؟"
      ↓
🤖 System: "شكراً لتواصلك! سنرد عليك قريباً"
      ↓
👑 Admin: يفتح messages.html → يرى الرسالة
      ↓
👑 Admin: يضغط "رد" → "اضغط على زر التحميل بجانب PDF"
      ↓
👤 User: يرى الرد في الشات! ✅
```

### **مثال 2: مشكلة تقنية**
```
👤 User: "الموقع لا يعمل على الموبايل"
      ↓
👑 Admin: يرى badge (1) → يفتح الرسائل
      ↓
👑 Admin: يرد: "تم حل المشكلة، جرب الآن"
      ↓
👤 User: يستقبل الرد خلال 10 ثواني ✅
```

---

## **📝 ملاحظات**

### **مهم:**
- الشات يظهر فقط للمستخدمين المسجلين
- الأدمن يرى كل الرسائل
- الـ badge يختفي بعد فتح messages.html
- الرسائل محفوظة في `data/messages.json`

### **للتطوير المستقبلي:**
1. استخدام Socket.io للتحديث الفوري
2. إضافة attachments
3. نظام تذاكر (Ticketing)
4. تصنيف الرسائل
5. بحث في الرسائل
6. أرشفة الرسائل القديمة

---

## **✅ الخلاصة**

نظام شات احترافي ومتكامل:
- ✅ سهل الاستخدام
- ✅ تصميم جميل
- ✅ تحديث تلقائي
- ✅ جاهز للإنتاج

**🎉 استمتع بنظام الشات! 💬**
