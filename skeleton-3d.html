<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>الهيكل العظمي الواقعي 3D</title>
    <style>
        body { 
            margin: 0; 
            font-family: 'Cairo', sans-serif; 
            background: linear-gradient(135deg, #0a0a0a, #1a1a2e); 
            color: #fff; 
            overflow: hidden;
            touch-action: none; /* Prevent default touch behaviors */
        }
        #canvas-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; }
        #loader { 
            position: absolute; 
            top: 50%; 
            left: 50%; 
            transform: translate(-50%, -50%); 
            font-size: 1.2em; 
            z-index: 100; 
            color: #4dc3ff; 
            text-align: center;
            padding: 20px;
        }
        .back-btn { 
            position: absolute; 
            top: 10px; 
            right: 10px; 
            background: rgba(255,255,255,0.1); 
            border: 1px solid #fff; 
            color: white; 
            padding: 12px 20px; 
            border-radius: 25px; 
            cursor: pointer; 
            z-index: 10; 
            text-decoration: none;
            font-size: 0.9em;
        }
        .info { 
            position: absolute; 
            bottom: 10px; 
            left: 10px; 
            background: rgba(0,0,0,0.8); 
            padding: 12px; 
            border-radius: 10px; 
            max-width: 280px;
            font-size: 0.85em;
            line-height: 1.6;
        }
        
        /* Mobile optimizations */
        @media (max-width: 768px) {
            #loader { font-size: 1em; padding: 15px; }
            .back-btn { 
                top: 5px; 
                right: 5px; 
                padding: 10px 15px; 
                font-size: 0.85em;
            }
            .info { 
                bottom: 5px; 
                left: 5px; 
                right: 5px;
                max-width: none;
                font-size: 0.75em;
                padding: 10px;
            }
        }
        
        /* Very small screens */
        @media (max-width: 480px) {
            .info { font-size: 0.7em; }
        }
    </style>
</head>
<body>
    <div id="canvas-container"></div>
    <div class="loader" id="loader">جاري تحميل الهيكل العظمي...</div>
    <a href="dashboard.html" class="back-btn">→ العودة للرئيسية</a>
    <div class="info">
        <strong>🦴 الهيكل العظمي البشري</strong><br>
        التحكم:<br>
        • تدوير: اسحب بإصبعك/الماوس<br>
        • تكبير/تصغير: اقرص بإصبعين/عجلة الماوس
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>

    <script>
        let scene, camera, renderer, controls, model;

        function init() {
            const container = document.getElementById('canvas-container');
            const loaderElement = document.getElementById('loader');

            // Scene
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x0a0a0a);

            // Camera
            camera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(0, 1.5, 4);

            // Renderer (optimized for mobile)
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            renderer = new THREE.WebGLRenderer({ 
                antialias: !isMobile, // Disable antialiasing on mobile for better performance
                powerPreference: 'high-performance'
            });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(Math.min(window.devicePixelRatio, isMobile ? 1.5 : 2));
            renderer.toneMapping = THREE.ACESFilmicToneMapping;
            renderer.toneMappingExposure = 1.0;
            container.appendChild(renderer.domElement);

            // Controls (optimized for touch)
            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.target.set(0, 1, 0);
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;
            controls.enablePan = true; // Allow panning on mobile
            controls.touches = {
                ONE: THREE.TOUCH.ROTATE,
                TWO: THREE.TOUCH.DOLLY_PAN
            };

            // Lighting
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
            scene.add(ambientLight);

            const keyLight = new THREE.DirectionalLight(0xffffff, 1.0);
            keyLight.position.set(5, 5, 5);
            scene.add(keyLight);

            const fillLight = new THREE.DirectionalLight(0x8888ff, 0.5);
            fillLight.position.set(-5, 0, -5);
            scene.add(fillLight);

            const backLight = new THREE.DirectionalLight(0xffffff, 0.7);
            backLight.position.set(0, 5, -5);
            scene.add(backLight);

            // Load the model
            const loader = new THREE.GLTFLoader();
            loader.load('/models/skeleton_realistic.glb', (gltf) => {
                model = gltf.scene;
                
                const box = new THREE.Box3().setFromObject(model);
                const center = box.getCenter(new THREE.Vector3());
                model.position.sub(center);
                
                scene.add(model);
                loaderElement.style.display = 'none';
            }, undefined, (error) => {
                console.error(error);
                loaderElement.innerHTML = 'فشل تحميل النموذج.<br>تأكد من وجود ملف skeleton_realistic.glb في مجلد models';
            });

            animate();
        }

        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            renderer.render(scene, camera);
        }

        window.onresize = () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        };

        init();
    </script>
</body>
</html>
